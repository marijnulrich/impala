<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=3, user-scalable=1"
    />
    <title>Testing</title>

    <script src="scormdriver.js" charset="utf-8"></script>

    <!-- Load xAPIWrapper from local file with 'defer' -->
    <script src="xapiwrapper.min.js" defer></script>  <!-- Ensure script loads before use -->

    <script>
      USE_LEGACY_IDENTIFIERS_FOR_2004 = true;
      REVIEW_MODE_IS_READ_ONLY = false;

      // Ensure xAPIWrapper is loaded
      window.onload = function () {
        if (typeof ADL === "undefined") {
          console.error("❌ xAPIWrapper failed to load. Check the script path.");
          return;
        }

        console.log("✅ xAPIWrapper loaded successfully!");

        // Configure Veracity LRS
        var conf = {
          endpoint: "https://github-test.lrs.io/xapi/",
          auth: "Basic " + btoa("vufeve:talvaz"),
        };
        ADL.XAPIWrapper.changeConfig(conf);

        // Generate a test user email dynamically
        function getTestUser() {
          let randomNum = Math.floor(Math.random() * 10000);
          return `testuser+${randomNum}@example.com`;
        }

        // Send xAPI statement
        function sendStatement(verbId, verbDisplay, objectId, objectName) {
          var statement = {
            actor: {
              mbox: "mailto:" + getTestUser(),
              name: "Test User",
              objectType: "Agent"
            },
            verb: {
              id: verbId,
              display: { "en-US": verbDisplay }
            },
            object: {
              id: objectId,
              definition: {
                name: { "en-US": objectName },
                description: { "en-US": "Tracking activity on the website" }
              },
              objectType: "Activity"
            }
          };

          ADL.XAPIWrapper.sendStatement(statement, function(resp, obj) {
            console.log("✅ xAPI Statement Sent:", statement, resp);
          });
        }

        // Track page load event
        sendStatement(
          "http://adlnet.gov/expapi/verbs/viewed",
          "viewed",
          "http://your-site-url.com",
          "Website Homepage"
        );
      };

      // Ensure scripts load properly
      const LoadContent = function () {
        [
          "assets/js/project.js",
          "dist/main.chunk.js",
          "dist/runtime-main.bundle.js",
          "dist/vendors-main.chunk.js",
        ].forEach((src) => {
          let script = document.createElement("script");
          script.src = src;
          script.charset = "utf-8";
          script.async = false;
          document.body.appendChild(script);
        });
      };
    </script>
  </head>
  <body>
    <div id="app" style="width: 100%; height: 100%"></div>
  </body>
</html>
